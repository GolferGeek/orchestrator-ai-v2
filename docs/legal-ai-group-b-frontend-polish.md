# Legal Department AI - Group B: Frontend Polish

**Priority:** MEDIUM
**Issues:** #4 (Markdown Rendering) + #7 (PDF Export) + #8 (Remove Checkboxes)
**Scope:** Vue.js frontend only

---

## Overview

Improve the frontend display quality by rendering markdown properly, fixing PDF export to match the UI, and removing non-functional UI elements.

---

## Issue #4: Executive Summary Markdown Rendering

### Problem

The Executive Summary displays raw markdown syntax instead of rendered content:
- `## Headings` shown as plain text
- `**bold**` shown as asterisks
- `| table |` syntax shown literally
- Checklist `- [ ]` items not rendered

### Solution

- Use `marked` library (already installed v15.0.11, used in `PlanDisplay.vue`)
- Apply markdown rendering to the Executive Summary section
- Style rendered HTML appropriately for the UI

### Implementation Pattern

```typescript
import { marked } from 'marked';
marked.setOptions({ breaks: true, gfm: true });
const renderedHtml = marked(summaryText);
```

In template, use `v-html` directive:
```vue
<div class="executive-summary" v-html="renderedSummary"></div>
```

### File to Modify

- `apps/web/src/views/agents/legal-department/components/SynthesisPanel.vue`

---

## Issue #7: PDF Export Fixes (Multi-Agent Support)

### Problem

- Missing sections: CLO routing, contract overview, key clauses, metrics, key issues
- Risk severity CSS doesn't match (case sensitivity: `CRITICAL` vs `critical`)
- No page break handling (content splits across pages)
- Executive summary shows raw markdown
- Doesn't match what's shown on screen
- **NEW**: Multi-agent mode now produces multiple specialist tabs - PDF only captures active tab

### Solution: Executive Summary + Appendices (Option D)

With multi-agent mode enabled, documents may be analyzed by multiple specialists (Contract, IP, Privacy, Compliance, Employment). The PDF must capture ALL specialist outputs in a structured format.

**PDF Structure:**

```
PART 1: EXECUTIVE OVERVIEW (Pages 1-3)
========================================
1. Header
   - Document name
   - Generated timestamp
   - Overall Risk Level badge (CRITICAL/HIGH/MEDIUM/LOW)

2. CLO Routing Summary
   - All specialists invoked (with icons)
   - Overall routing confidence
   - "Why these specialists?" reasoning

3. Aggregated Metrics Dashboard
   - Total Findings count
   - Total Risks count
   - Total Recommendations count
   - Specialists count

4. Risk Breakdown
   - Visual bar chart (Critical/High/Medium/Low)
   - Counts for each severity level

5. Key Issues (Combined)
   - Top critical issues from ALL specialists
   - Warning icons with descriptions

6. Executive Summary
   - Overall Risk Level
   - RENDERED markdown (not raw)
   - Synthesized findings across all specialists

PART 2: SPECIALIST APPENDICES (Remaining pages)
===============================================
For EACH specialist that ran, include a dedicated section:

Appendix A: Contract Analysis (if invoked)
   - Confidence badge
   - Contract Overview (type, tags, description)
   - Risk Flags (severity, description, recommendation)
   - Key Clauses grid

Appendix B: IP Analysis (if invoked)
   - Confidence badge
   - Overview
   - Risk Flags
   - Recommendations

Appendix C: Privacy Analysis (if invoked)
   - Confidence badge
   - Overview
   - Risk Flags
   - Regulatory concerns (GDPR, CCPA, COPPA)

Appendix D: Compliance Analysis (if invoked)
   - Confidence badge
   - Overview
   - Policy Compliance Checks (with status badges)
   - Recommendations

Appendix E: Employment Analysis (if invoked)
   - Confidence badge
   - Overview
   - Risk Flags (non-compete, restrictive covenants)
   - Recommendations

(Additional appendices for Corporate, Litigation, Real Estate as needed)

FOOTER (All pages)
==================
- "Generated by Legal Department AI"
- Page numbers (Page X of Y)
- Timestamp
```

### Implementation Plan

**Step 1: Refactor PDF generation to iterate specialists**
```typescript
// Get all specialist outputs
const specialists = Object.keys(analysisResults.specialistOutputs || {});

// Generate Part 1: Executive Overview
generateExecutiveOverview(analysisResults, routingDecision);

// Generate Part 2: Appendices for each specialist
for (const [index, specialistKey] of specialists.entries()) {
  const output = analysisResults.specialistOutputs[specialistKey];
  generateSpecialistAppendix(
    String.fromCharCode(65 + index), // A, B, C, D, E...
    specialistKey,
    output
  );
}
```

**Step 2: Add Table of Contents (for 2+ specialists)**
```typescript
if (specialists.length > 1) {
  generateTableOfContents(specialists);
}
```

**Step 3: Page break handling**
```css
.pdf-section {
  page-break-before: always;
}
.risk-item, .finding-item, .clause-item {
  page-break-inside: avoid;
}
.appendix-header {
  page-break-before: always;
}
```

**Step 4: Severity CSS fix**
```typescript
`risk-${risk.severity.toLowerCase()}`
```

**Step 5: Markdown rendering**
```typescript
import { marked } from 'marked';
marked.setOptions({ breaks: true, gfm: true });
const renderedSummary = marked(analysisResults.executiveSummary);
```

### Specialist-Specific Rendering

Each specialist has different output structures. Map them appropriately:

| Specialist | Key Sections |
|------------|--------------|
| Contract | overview, riskFlags, keyClauses, recommendations |
| IP | overview, riskFlags, recommendations |
| Privacy | overview, riskFlags, regulatoryFlags, recommendations |
| Compliance | overview, policyChecks, recommendations |
| Employment | overview, riskFlags, restrictiveCovenants, recommendations |
| Corporate | overview, governanceIssues, recommendations |
| Litigation | overview, riskFlags, recommendations |
| Real Estate | overview, riskFlags, propertyDetails, recommendations |

### File to Modify

- `apps/web/src/views/agents/legal-department/LegalDepartmentConversation.vue` (exportToPdf function)

---

## Issue #8: Remove Analysis Options Checkboxes

### Problem

UI has three checkboxes that do nothing:
- Extract Key Terms
- Identify Risks
- Generate Recommendations

Backend completely ignores these options. All analysis always runs regardless of checkbox state.

### Solution

- Remove the checkboxes from the UI
- Legal analysis should always be comprehensive
- Simplifies the interface

### File to Modify

- `apps/web/src/views/agents/legal-department/components/DocumentUpload.vue`

---

## Dependencies

- Issue #7 (PDF Export) depends on Issue #4 (Markdown) - same rendering approach needed
- Issue #7 (PDF Export) depends on Group A being complete - multi-agent mode must be working for multi-specialist PDF export
- Implement Issue #4 first, then #7 can reuse the pattern
- Issue #8 is independent

**Note:** Group A (Multi-Agent + Parallel Execution) is now complete âœ…. The PDF export must handle the case where multiple specialists (up to 8) may have run.

---

## Testing Plan

1. **Markdown (#4)**:
   - Upload any document
   - Check Executive Summary renders headings, bold, tables, checklists properly
   - Verify styling matches the rest of the UI

2. **PDF Export (#7)** - Single Specialist:
   - Upload a simple contract document (triggers only Contract specialist)
   - Click Export PDF button
   - Verify Executive Overview section is present
   - Verify single Appendix A (Contract Analysis) is included
   - Verify risk severity badges have correct colors
   - Verify no content splits mid-section across pages
   - Verify executive summary markdown is rendered (not raw)

3. **PDF Export (#7)** - Multi-Agent:
   - Upload TEST-10-multi-issue.md (triggers 5 specialists)
   - Click Export PDF button
   - Verify Part 1 (Executive Overview) contains:
     - All 5 specialists shown in CLO Routing
     - Aggregated metrics (combined from all specialists)
     - Combined key issues
   - Verify Part 2 (Appendices) contains:
     - Appendix A: Contract Analysis
     - Appendix B: IP Analysis
     - Appendix C: Privacy Analysis
     - Appendix D: Compliance Analysis
     - Appendix E: Employment Analysis
   - Verify Table of Contents is present (since 5 specialists)
   - Verify page breaks between appendices
   - Verify each appendix has specialist-specific content

4. **Checkboxes (#8)**:
   - Verify checkboxes are removed from upload interface
   - Verify document analysis still works correctly

---

## Reference: marked Library Usage

From existing `PlanDisplay.vue`:
```typescript
import { marked } from 'marked';
marked.setOptions({ breaks: true, gfm: true });
```

The library is already installed (v15.0.11) - no package.json changes needed.
