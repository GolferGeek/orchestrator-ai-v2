{
  "metadata": {
    "version": "1.0",
    "created_at": "2026-01-11T16:51:00Z",
    "prd_sources": ["docs/prd/2026-01-11-test-based-learning-loop.md"],
    "title": "Test-Based Learning Loop",
    "summary": "Create a controlled test environment for the prediction system with T_ prefixed test targets, DB-backed test data, unified runner architecture, and learning promotion workflow",
    "goals": [
      "Complete isolation between test and production data (is_test flag)",
      "High-velocity learning via test scenarios",
      "DB-backed test inputs (no external mock URLs)",
      "Automatic T_ mirror creation for all real targets",
      "Learning promotion with human review gates"
    ],
    "invariants": [
      "INV-01: Production API endpoints MUST exclude is_test=true by default",
      "INV-02: Signals from is_test=true sources MUST have is_test=true",
      "INV-03: Predictors from is_test=true signals MUST have is_test=true",
      "INV-04: is_test=true predictors can ONLY affect T_ prefixed targets",
      "INV-05: Production climate/sentiment queries MUST filter is_test=false",
      "INV-06: Production accuracy metrics MUST exclude is_test=true predictions",
      "INV-07: Learning promotion MUST be human-approved, audited action",
      "INV-08: Test targets MUST have T_ prefix",
      "INV-09: Promoted learning becomes is_test=false; original preserved",
      "INV-10: Scenario runs MUST record full version info",
      "INV-11: Every real target MUST have T_ test mirror auto-created"
    ],
    "scenarios": [
      "SCN-001: Earnings beat (single target)",
      "SCN-002: Earnings miss (single target)",
      "SCN-003: Cross-market macro shock",
      "SCN-004: Mixed news (same target)",
      "SCN-005: Ambiguous language",
      "SCN-006: Entity collision / ticker ambiguity",
      "SCN-007: Noisy irrelevant news",
      "SCN-008: Price-only scenario",
      "SCN-009: Multi-target single article",
      "SCN-010: Scheduled-job ingestion",
      "SCN-011: Leakage attempt (hard fail)",
      "SCN-012: Promotion gate happy path",
      "SCN-013: Promotion gate rejection",
      "SCN-014: Mirror auto-creation"
    ]
  },
  "summary": "Create a controlled test environment for the prediction system with T_ prefixed test targets, DB-backed test data, unified runner architecture, and learning promotion workflow",
  "phases": [
    {
      "id": "phase-1",
      "label": "Schema Foundation",
      "description": "Add is_test columns, create test infrastructure tables, and enforcement triggers",
      "status": "completed",
      "progress": 100,
      "started_at": "2026-01-11T16:58:00Z",
      "completed_at": "2026-01-11T17:10:00Z",
      "steps": [
        {
          "id": "step-1-1",
          "action": "Create migration: Add is_test column to prediction.sources table with index",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000001_prediction_is_test_sources.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "table": "prediction.sources",
            "column": "is_test BOOLEAN NOT NULL DEFAULT false",
            "index": "idx_prediction_sources_is_test"
          }
        },
        {
          "id": "step-1-2",
          "action": "Create migration: Add is_test column to prediction.signals table with index",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000002_prediction_is_test_signals.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "table": "prediction.signals",
            "column": "is_test BOOLEAN NOT NULL DEFAULT false",
            "index": "idx_prediction_signals_is_test",
            "also_add": "scenario_run_id UUID REFERENCES prediction.scenario_runs(id)"
          }
        },
        {
          "id": "step-1-3",
          "action": "Create migration: Add is_test column to prediction.predictors table with index",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000003_prediction_is_test_predictors.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "table": "prediction.predictors",
            "column": "is_test BOOLEAN NOT NULL DEFAULT false",
            "index": "idx_prediction_predictors_is_test",
            "also_add": "scenario_run_id UUID REFERENCES prediction.scenario_runs(id)"
          }
        },
        {
          "id": "step-1-4",
          "action": "Create migration: Add is_test column to prediction.predictions table with index",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000004_prediction_is_test_predictions.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "table": "prediction.predictions",
            "column": "is_test BOOLEAN NOT NULL DEFAULT false",
            "index": "idx_prediction_predictions_is_test",
            "also_add": "scenario_run_id UUID REFERENCES prediction.scenario_runs(id)"
          }
        },
        {
          "id": "step-1-5",
          "action": "Create migration: Add is_test column to prediction.evaluations, learnings, learning_queue, missed_opportunities, target_snapshots",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000005_prediction_is_test_remaining.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "tables": ["prediction.evaluations", "prediction.learnings", "prediction.learning_queue", "prediction.missed_opportunities", "prediction.target_snapshots"],
            "column": "is_test BOOLEAN NOT NULL DEFAULT false"
          }
        },
        {
          "id": "step-1-6",
          "action": "Create migration: Create prediction.test_scenarios table",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000006_prediction_test_scenarios.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "15.3.1 Test Scenarios Table"
          }
        },
        {
          "id": "step-1-7",
          "action": "Create migration: Create prediction.scenario_runs table for execution tracking",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": ["apps/api/supabase/migrations/20260111000007_prediction_scenario_runs.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "12.2 Scenario Runs Table"
          }
        },
        {
          "id": "step-1-8",
          "action": "Create migration: Create prediction.test_articles table",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": ["apps/api/supabase/migrations/20260111000008_prediction_test_articles.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "15.3.2 Test Articles Table"
          }
        },
        {
          "id": "step-1-9",
          "action": "Create migration: Create prediction.test_price_data table",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": ["apps/api/supabase/migrations/20260111000009_prediction_test_price_data.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "15.3.3 Test Price Data Table",
            "constraint": "symbol LIKE 'T_%'"
          }
        },
        {
          "id": "step-1-10",
          "action": "Create migration: Create prediction.test_target_mirrors table with auto-creation trigger",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000010_prediction_test_target_mirrors.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "5.2 Mirror Mapping Table",
            "invariant": "INV-11",
            "trigger": "trg_auto_create_test_mirror"
          }
        },
        {
          "id": "step-1-11",
          "action": "Create migration: Add enforcement triggers for is_test propagation (INV-02, INV-03, INV-04)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-1", "step-1-2", "step-1-3"],
          "deliverables": ["apps/api/supabase/migrations/20260111000011_prediction_is_test_triggers.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "15.4 Enforcement Triggers",
            "invariants": ["INV-02", "INV-03", "INV-04"],
            "triggers": ["trg_enforce_signal_is_test", "trg_enforce_predictor_is_test", "trg_enforce_test_target_isolation"]
          }
        },
        {
          "id": "step-1-12",
          "action": "Create migration: Create prediction.test_audit_log table",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": ["apps/api/supabase/migrations/20260111000012_prediction_test_audit_log.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "11.3 Audit Logging",
            "invariant": "INV-07"
          }
        },
        {
          "id": "step-1-13",
          "action": "Create migration: Create prediction.learning_lineage table",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-5", "step-1-7"],
          "deliverables": ["apps/api/supabase/migrations/20260111000013_prediction_learning_lineage.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "12.4 Learning Lineage",
            "invariant": "INV-09"
          }
        },
        {
          "id": "step-1-14",
          "action": "Create migration: Backfill T_ mirrors for all existing real targets",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-10"],
          "deliverables": ["apps/api/supabase/migrations/20260111000014_prediction_backfill_mirrors.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "description": "Create T_ mirrors for all existing targets where symbol NOT LIKE 'T_%'"
          }
        },
        {
          "id": "step-1-15",
          "action": "Create migration: Add production-safe partial indexes (exclude is_test=true)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-1", "step-1-2", "step-1-3", "step-1-4", "step-1-5"],
          "deliverables": ["apps/api/supabase/migrations/20260111000015_prediction_production_indexes.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "13.3 Index Optimization",
            "indexes": ["idx_signals_production", "idx_predictors_production", "idx_predictions_production"]
          }
        },
        {
          "id": "step-1-16",
          "action": "Create migration: Add v_test_data_stats monitoring view",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6", "step-1-8", "step-1-9"],
          "deliverables": ["apps/api/supabase/migrations/20260111000016_prediction_test_data_stats_view.sql"],
          "validation_checkpoint": "checkpoint-schema",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "13.4 Storage Monitoring"
          }
        }
      ]
    },
    {
      "id": "phase-2",
      "label": "Test Input Infrastructure",
      "description": "Implement DB-backed ingestion for test articles and prices, modify tools to detect T_ prefix",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-2-1",
          "action": "Create TestArticleService for CRUD operations on prediction.test_articles",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-8"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/test-article.service.ts",
            "apps/api/src/modules/prediction/test/dto/test-article.dto.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "operations": ["create", "read", "update", "delete", "findByScenario", "findByTargets"]
          }
        },
        {
          "id": "step-2-2",
          "action": "Create TestPriceDataService for CRUD operations on prediction.test_price_data",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-9"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/test-price-data.service.ts",
            "apps/api/src/modules/prediction/test/dto/test-price-data.dto.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "operations": ["create", "bulkCreate", "getLatestPrice", "getPriceTimeline"],
            "validation": "symbol must start with T_"
          }
        },
        {
          "id": "step-2-3",
          "action": "Create TestScenarioService for CRUD operations on prediction.test_scenarios",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/test-scenario.service.ts",
            "apps/api/src/modules/prediction/test/dto/test-scenario.dto.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "operations": ["create", "read", "update", "delete", "createFromLearning", "createFromMissedOpportunity"]
          }
        },
        {
          "id": "step-2-4",
          "action": "Create ScenarioRunnerService for executing scenarios and creating scenario_runs",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-7", "step-2-1", "step-2-2", "step-2-3"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/scenario-runner.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "8.2 Scenario Execution Model",
            "operations": ["run", "injectData", "evaluateOutcome", "recordResults"]
          }
        },
        {
          "id": "step-2-5",
          "action": "Modify crypto price tool to detect T_ prefix and route to test_price_data",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-2"],
          "deliverables": [
            "apps/api/src/modules/prediction/tools/crypto-price.tool.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "behavior": "If symbol starts with T_, read from prediction.test_price_data instead of external API"
          }
        },
        {
          "id": "step-2-6",
          "action": "Modify stock price tool to detect T_ prefix and route to test_price_data",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-2"],
          "deliverables": [
            "apps/api/src/modules/prediction/tools/stock-price.tool.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "behavior": "If symbol starts with T_, read from prediction.test_price_data instead of Polygon API"
          }
        },
        {
          "id": "step-2-7",
          "action": "Create test_db source type handler that reads from test_articles table",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-1"],
          "deliverables": [
            "apps/api/src/modules/prediction/sources/test-db-source.handler.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "7.1.3 Test Source Types",
            "source_type": "test_db",
            "behavior": "Read unprocessed articles from prediction.test_articles, mark as processed"
          }
        },
        {
          "id": "step-2-8",
          "action": "Modify unified runner to process test_db sources alongside real sources",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-7"],
          "deliverables": [
            "apps/api/src/modules/prediction/runners/unified-runner.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "8.3 Unified Runner Architecture",
            "behavior": "Same scheduled job processes both real and test sources"
          }
        },
        {
          "id": "step-2-9",
          "action": "Add is_test propagation to signal creation service",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-11"],
          "deliverables": [
            "apps/api/src/modules/prediction/services/signal.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "invariant": "INV-02",
            "behavior": "Signals inherit is_test from source"
          }
        },
        {
          "id": "step-2-10",
          "action": "Add is_test propagation to predictor creation service",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-11"],
          "deliverables": [
            "apps/api/src/modules/prediction/services/predictor.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "invariants": ["INV-03", "INV-04"],
            "behavior": "Predictors inherit is_test from signal, can only affect T_ targets if is_test=true"
          }
        },
        {
          "id": "step-2-11",
          "action": "Create TestController with endpoints for test scenarios, articles, prices",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-1", "step-2-2", "step-2-3", "step-2-4"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/test.controller.ts",
            "apps/api/src/modules/prediction/test/test.module.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "18. API Specifications",
            "endpoints": [
              "POST /api/prediction/test-scenarios",
              "POST /api/prediction/test-scenarios/:id/run",
              "POST /api/prediction/test-scenarios/from-learning",
              "POST /api/prediction/test-scenarios/from-missed",
              "POST /api/prediction/test-articles",
              "POST /api/prediction/test-articles/generate",
              "POST /api/prediction/test-prices",
              "POST /api/prediction/test-prices/bulk"
            ]
          }
        },
        {
          "id": "step-2-12",
          "action": "Add RBAC middleware to filter is_test data by permission (INV-01)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-11"],
          "deliverables": [
            "apps/api/src/modules/prediction/middleware/test-data-filter.middleware.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "11.2 Fail-Closed Defaults",
            "invariant": "INV-01",
            "behavior": "Production endpoints exclude is_test=true unless user has view_test_data permission"
          }
        }
      ]
    },
    {
      "id": "phase-3",
      "label": "Test Data Management UI",
      "description": "Build Vue.js screens for test targets, articles, prices, and scenario builder",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-3-1",
          "action": "Create test store module for state management",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-11"],
          "deliverables": [
            "apps/web/src/stores/prediction/test.store.ts"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "state": ["scenarios", "articles", "prices", "runs", "testMode"],
            "actions": ["fetchScenarios", "createScenario", "runScenario", "toggleTestMode"]
          }
        },
        {
          "id": "step-3-2",
          "action": "Create SCR-001: Test Control Center screen (/test)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/TestControlCenter.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.6 SCR-001",
            "route": "/test",
            "features": ["scenario count by status", "recent runs", "promotion queue backlog", "storage warnings"]
          }
        },
        {
          "id": "step-3-3",
          "action": "Create SCR-002: Targets & Mirrors screen (/test/targets)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/TargetsAndMirrors.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.5",
            "route": "/test/targets",
            "features": ["view real targets and T_ mirrors", "verify auto-creation"]
          }
        },
        {
          "id": "step-3-4",
          "action": "Create SCR-003: Synthetic Articles Library screen (/test/articles)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/SyntheticArticlesLibrary.vue",
            "apps/web/src/components/prediction/test/ArticleEditor.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.5",
            "route": "/test/articles",
            "features": ["create/edit synthetic articles", "AI generation", "guardrails enforcement"]
          }
        },
        {
          "id": "step-3-5",
          "action": "Create SCR-004: Test Price Timeline screen (/test/prices)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/TestPriceTimeline.vue",
            "apps/web/src/components/prediction/test/PriceTimelineEditor.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.5",
            "route": "/test/prices",
            "features": ["create/edit price series", "relative time input (T-1d, T+2h)", "T_ symbol enforcement"]
          }
        },
        {
          "id": "step-3-6",
          "action": "Create SCR-005: Scenario Builder screen (/test/scenarios/new)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-3", "step-3-4", "step-3-5"],
          "deliverables": [
            "apps/web/src/views/prediction/test/ScenarioBuilder.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.6 SCR-005",
            "route": "/test/scenarios/new",
            "features": ["select test targets", "attach articles", "define price movements", "set expected outcome", "save/run"],
            "validation": "blocks non-T_ targets, synthetic marker required"
          }
        },
        {
          "id": "step-3-7",
          "action": "Create SCR-006: Scenario Run Detail screen (/test/runs/:runId)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/ScenarioRunDetail.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.6 SCR-006",
            "route": "/test/runs/:runId",
            "features": ["run metadata", "expected vs actual outcome", "linked artifacts", "replay", "compare runs"]
          }
        },
        {
          "id": "step-3-8",
          "action": "Create TEST MODE toggle component with visual indicator",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-1"],
          "deliverables": [
            "apps/web/src/components/prediction/test/TestModeToggle.vue",
            "apps/web/src/components/prediction/test/TestModeBadge.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.1 Test Mode Indicator",
            "features": ["orange/yellow TEST MODE badge", "filter toggle", "RBAC enforcement"]
          }
        },
        {
          "id": "step-3-9",
          "action": "Add /test routes to Vue router configuration",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-2", "step-3-3", "step-3-4", "step-3-5", "step-3-6", "step-3-7"],
          "deliverables": [
            "apps/web/src/router/prediction-test.routes.ts"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "20.6.2 Screen Route Map",
            "routes": ["/test", "/test/targets", "/test/articles", "/test/prices", "/test/scenarios/new", "/test/runs/:runId"]
          }
        }
      ]
    },
    {
      "id": "phase-4",
      "label": "Test Scenario Generation",
      "description": "AI-powered article generation, automatic scenario creation from learnings and missed opportunities",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-4-1",
          "action": "Create ArticleGeneratorService for AI-powered synthetic article generation",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-1"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/article-generator.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "7.3 AI-Generated Test Content",
            "features": ["generate from prompts", "enforce T_ prefix", "add synthetic marker", "sentiment/strength control"]
          }
        },
        {
          "id": "step-4-2",
          "action": "Create ScenarioGeneratorService for automatic scenario creation from missed opportunities",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-3", "step-4-1"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/scenario-generator.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "5.5 Scenario Generation from Real Events",
            "features": ["create from missed opportunity", "create from evaluation", "rewrite articles for T_ targets", "map historical prices"]
          }
        },
        {
          "id": "step-4-3",
          "action": "Create ScenarioVariationService for generating scenario variations",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-3"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/scenario-variation.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "17.4 Scenario Catalog",
            "features": ["timing variations", "sentiment strength variations", "conflicting signal variations"]
          }
        },
        {
          "id": "step-4-4",
          "action": "Add article generation endpoint with guardrails",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-1", "step-2-11"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/test.controller.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "11.5 AI Article Generation Safety",
            "endpoint": "POST /api/prediction/test-articles/generate",
            "guardrails": ["enforce_test_prefix", "include_synthetic_marker", "block_real_entity_names"]
          }
        }
      ]
    },
    {
      "id": "phase-5",
      "label": "Learning Promotion Workflow",
      "description": "Validation metrics, promotion queue, human review interface, backtest integration",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-5-1",
          "action": "Create LearningValidationService for tracking test learning effectiveness",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-5"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/learning-validation.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "9.4 Learning Promotion Workflow",
            "features": ["track times_applied", "track times_helpful", "calculate success rate"]
          }
        },
        {
          "id": "step-5-2",
          "action": "Create LearningPromotionService for promotion workflow with gates",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-1", "step-1-13"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/learning-promotion.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "11.4 Promotion Workflow Boundaries",
            "invariants": ["INV-07", "INV-09"],
            "gates": ["validation_gate", "backtest_gate", "review_gate"],
            "features": ["create production learning", "preserve test learning", "create lineage record", "audit log"]
          }
        },
        {
          "id": "step-5-3",
          "action": "Create BacktestService for validating learnings against historical data",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-1"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/backtest.service.ts",
            "apps/api/src/modules/prediction/test/dto/backtest.dto.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "10. Backtesting Specification",
            "features": ["select backtest window", "gather historical data", "apply learning hypothetically", "score improvement", "pass/fail criteria"]
          }
        },
        {
          "id": "step-5-4",
          "action": "Add promotion endpoints with RBAC enforcement",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-2"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/test.controller.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "18.4 Learning Promotion Endpoints",
            "endpoints": [
              "GET /api/prediction/learnings/promotion-candidates",
              "POST /api/prediction/learnings/:id/promote"
            ],
            "rbac": "reviewer or admin only"
          }
        },
        {
          "id": "step-5-5",
          "action": "Create SCR-007: Learnings Validation & Promotion screen (/test/learnings/promotion)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-4", "step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/LearningsPromotion.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.6 SCR-007",
            "route": "/test/learnings/promotion",
            "features": ["candidate list", "validation metrics", "backtest status", "lineage", "approve/reject with notes"]
          }
        },
        {
          "id": "step-5-6",
          "action": "Create SCR-008: Backtests screen (/test/backtests)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-3", "step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/Backtests.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.5",
            "route": "/test/backtests",
            "features": ["configure backtest", "run backtest", "view results"]
          }
        },
        {
          "id": "step-5-7",
          "action": "Create SCR-009: Test Audit Log screen (/test/audit)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-12", "step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/TestAuditLog.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.6 SCR-009",
            "route": "/test/audit",
            "features": ["filter by action", "filter by resource", "exportable view"]
          }
        }
      ]
    },
    {
      "id": "phase-6",
      "label": "Analytics & Insights",
      "description": "Test vs production metrics, observability split, Playwright E2E tests",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-6-1",
          "action": "Create TestAnalyticsService for test-specific metrics",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-5"],
          "deliverables": [
            "apps/api/src/modules/prediction/test/services/test-analytics.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "14. Observability Split",
            "features": ["test prediction accuracy", "learning velocity", "scenario effectiveness", "promotion rate"]
          }
        },
        {
          "id": "step-6-2",
          "action": "Add is_test tagging to all prediction metrics",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-6-1"],
          "deliverables": [
            "apps/api/src/modules/prediction/metrics/prediction-metrics.service.ts"
          ],
          "validation_checkpoint": "checkpoint-api",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "14.3 Tagging Requirements",
            "invariants": ["INV-05", "INV-06"],
            "behavior": "All metrics include is_test tag"
          }
        },
        {
          "id": "step-6-3",
          "action": "Create SCR-010: Analytics Split screen (/test/analytics)",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-6-1", "step-3-1"],
          "deliverables": [
            "apps/web/src/views/prediction/test/AnalyticsSplit.vue"
          ],
          "validation_checkpoint": "checkpoint-web",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "19.5",
            "route": "/test/analytics",
            "features": ["test vs production accuracy", "learning velocity", "predictor discovery rate", "scenario effectiveness"]
          }
        },
        {
          "id": "step-6-4",
          "action": "Create Playwright E2E test: PW-001/002 Test mode default and toggle",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-8", "step-3-2"],
          "deliverables": [
            "apps/web/tests/e2e/prediction/test-mode.spec.ts"
          ],
          "validation_checkpoint": "checkpoint-e2e",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "20.4.2 Playwright Test Matrix",
            "tests": ["PW-001", "PW-002"],
            "invariant": "INV-01"
          }
        },
        {
          "id": "step-6-5",
          "action": "Create Playwright E2E test: PW-003/005 Scenario builder validation",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-6"],
          "deliverables": [
            "apps/web/tests/e2e/prediction/scenario-builder.spec.ts"
          ],
          "validation_checkpoint": "checkpoint-e2e",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "20.4.2 Playwright Test Matrix",
            "tests": ["PW-003", "PW-005"],
            "invariant": "INV-08",
            "scenario": "SCN-011"
          }
        },
        {
          "id": "step-6-6",
          "action": "Create Playwright E2E test: PW-004 Scenario run happy path",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-6", "step-3-7"],
          "deliverables": [
            "apps/web/tests/e2e/prediction/scenario-run.spec.ts"
          ],
          "validation_checkpoint": "checkpoint-e2e",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "20.4.2 Playwright Test Matrix",
            "tests": ["PW-004"],
            "invariants": ["INV-02", "INV-03", "INV-04", "INV-10"],
            "scenario": "SCN-001"
          }
        },
        {
          "id": "step-6-7",
          "action": "Create Playwright E2E test: PW-006/007/008 Promotion workflow",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-5", "step-5-6", "step-5-7"],
          "deliverables": [
            "apps/web/tests/e2e/prediction/promotion-workflow.spec.ts"
          ],
          "validation_checkpoint": "checkpoint-e2e",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "20.4.2 Playwright Test Matrix",
            "tests": ["PW-006", "PW-007", "PW-008"],
            "invariants": ["INV-07", "INV-09"],
            "scenarios": ["SCN-012", "SCN-013"]
          }
        },
        {
          "id": "step-6-8",
          "action": "Create Playwright E2E test: PW-009 Mirror auto-creation verification",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-3"],
          "deliverables": [
            "apps/web/tests/e2e/prediction/mirror-creation.spec.ts"
          ],
          "validation_checkpoint": "checkpoint-e2e",
          "human_checkpoint_id": null,
          "context": {
            "prd_section": "20.4.2 Playwright Test Matrix",
            "tests": ["PW-009"],
            "invariant": "INV-11",
            "scenario": "SCN-014"
          }
        }
      ]
    }
  ],
  "checkpoints": [
    {
      "id": "checkpoint-schema",
      "label": "Schema Validation",
      "description": "Run migrations and verify all tables, triggers, and indexes are created correctly",
      "status": "pending",
      "triggered_after": ["step-1-16"],
      "validation_commands": [
        "cd apps/api && npm run db:migrate",
        "cd apps/api && npm run db:generate-types"
      ]
    },
    {
      "id": "checkpoint-api",
      "label": "API Quality Gates",
      "description": "Run lint, build, and API tests",
      "status": "pending",
      "triggered_after": ["step-2-12"],
      "validation_commands": [
        "cd apps/api && npm run lint",
        "cd apps/api && npm run build",
        "cd apps/api && npm run test"
      ]
    },
    {
      "id": "checkpoint-web",
      "label": "Web Quality Gates",
      "description": "Run lint, build, and component tests for web app",
      "status": "pending",
      "triggered_after": ["step-3-9"],
      "validation_commands": [
        "cd apps/web && npm run lint",
        "cd apps/web && npm run build:check",
        "cd apps/web && npm run test"
      ]
    },
    {
      "id": "checkpoint-e2e",
      "label": "Playwright E2E Tests",
      "description": "Run Playwright E2E test suite",
      "status": "pending",
      "triggered_after": ["step-6-8"],
      "validation_commands": [
        "cd apps/web && npx playwright test"
      ]
    },
    {
      "id": "checkpoint-invariants",
      "label": "Invariant Verification",
      "description": "Verify all 11 invariants have automated tests",
      "status": "pending",
      "triggered_after": ["step-6-8"],
      "validation_criteria": [
        "INV-01: PW-001/002 pass",
        "INV-02..04: PW-004 pass",
        "INV-05..06: Analytics metrics correctly filtered",
        "INV-07..09: PW-006/007/008 pass",
        "INV-10: PW-004 verifies version recording",
        "INV-11: PW-009 pass"
      ]
    },
    {
      "id": "checkpoint-dod",
      "label": "Definition of Done",
      "description": "Final verification that all DOD criteria are met",
      "status": "pending",
      "triggered_after": ["checkpoint-e2e", "checkpoint-invariants"],
      "validation_criteria": [
        "All scenarios SCN-001..SCN-014 can be executed end-to-end",
        "All Playwright tests PW-001..PW-009 are green",
        "All invariants INV-01..INV-11 have automated tests",
        "Reviewer can promote learning with full lineage and audit trail"
      ]
    }
  ],
  "dependencies": {
    "phase-2": ["phase-1"],
    "phase-3": ["phase-2"],
    "phase-4": ["phase-2"],
    "phase-5": ["phase-2", "phase-3"],
    "phase-6": ["phase-3", "phase-4", "phase-5"]
  },
  "execution_strategy": {
    "mode": "sequential_with_parallel_steps",
    "parallel_phases": [["phase-3", "phase-4"]],
    "notes": "Phase 3 (UI) and Phase 4 (AI generation) can run in parallel after Phase 2"
  }
}
