{
  "metadata": {
    "version": "1.0",
    "created_at": "2026-01-07T00:00:00Z",
    "prd_sources": ["docs/prd/market-prediction-runner.prd.md"],
    "title": "Market Prediction Runner Architecture",
    "summary": "Build generic prediction engine with domain-specific runners (stocks, crypto, Polymarket) through shared runner framework with embedded LangGraph, claims-based data model, dashboard UI, and learning loop",
    "goals": [
      "Replace monolithic Finance Agent with modular runner architecture",
      "Enable multi-domain predictions (stocks, crypto, Polymarket, elections)",
      "Model universes as agents in database",
      "Reuse 70%+ code across domains via base runner inheritance",
      "Build dashboard-style agent UI (not chat-based)"
    ],
    "scope": {
      "in_scope": [
        "Base prediction runner with embedded LangGraph",
        "Stock predictor runner with Yahoo Finance, Alpha Vantage tools",
        "Crypto predictor runner with Binance, CoinGecko tools",
        "Market predictor runner with Polymarket API tools",
        "predictions schema with datapoints, runs, recommendations, outcomes",
        "Dashboard UI components for prediction agents",
        "Ambient agent lifecycle (start/stop/pause, auto-start)",
        "Learning loop with SQL retrieval and context updates",
        "Per-stage model configuration (admin only)"
      ],
      "out_of_scope": [
        "Election predictor (future phase)",
        "Trading execution",
        "Real-time streaming data",
        "Mobile UI"
      ]
    },
    "risks": [
      "API rate limits on free data sources (Yahoo, Alpha Vantage)",
      "Schema migration complexity for existing Finance Agent data",
      "LangGraph embedded in API may increase memory footprint"
    ]
  },
  "summary": "Build generic prediction engine with domain-specific runners (stocks, crypto, Polymarket) through shared runner framework with embedded LangGraph, claims-based data model, dashboard UI, and learning loop",
  "phases": [
    {
      "id": "phase-0",
      "label": "Contracts & Wiring (Foundation)",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-0-1",
          "action": "Create core type definitions in base-prediction.types.ts (Claim, Source, Datapoint, ClaimBundle, EnrichedClaimBundle, RunnerInput, RunnerOutput, PredictionRunnerConfig interfaces)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": [],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/base-prediction.types.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-0-2",
          "action": "Create ClaimProcessor interface with groupClaims(), enrichWithHistory(), shouldProceedToSpecialists() methods and DefaultClaimProcessor implementation",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/claim-processor.interface.ts",
            "apps/api/src/agent2agent/runners/prediction/base/default-claim-processor.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-0-3",
          "action": "Create RUNNER_REGISTRY mapping and RunnerFactoryService with getRunner(agentSlug) method",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/runner-factory.service.ts",
            "apps/api/src/agent2agent/runners/prediction/runner-registry.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-0-4",
          "action": "Document metadata.runnerConfig contract and create helper types for extracting runner config from agent metadata",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/agent-metadata.types.ts"
          ],
          "validation_checkpoint": "checkpoint-0",
          "human_checkpoint_id": null
        }
      ]
    },
    {
      "id": "phase-1",
      "label": "Base Infrastructure",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-1-1",
          "action": "Copy PostgresCheckpointerService from langgraph app to API app (apps/api/src/agent2agent/runners/prediction/base/postgres-checkpointer.service.ts)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-4"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/postgres-checkpointer.service.ts",
            "apps/api/src/agent2agent/runners/prediction/base/postgres-checkpointer.module.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-1-2",
          "action": "Create PredictionStateAnnotation with agentId, agentSlug, instruments, riskProfile, datapoint, instrumentBundles, recommendations fields",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/base-prediction.state.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-1-3",
          "action": "Create BasePredictionRunnerService abstract class with execute(), buildGraph(), pollDataNode(), groupClaimsNode(), processBundlesNode(), storeResultsNode() methods",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-1", "step-1-2", "step-0-2"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/base-prediction-runner.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-1-4",
          "action": "Create PredictionDbService with storeDatapoint(), getClaimsForInstrument(), getClaimsDiff(), getDatapointsForInstrument() methods using predictions schema",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/prediction-db.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-1-5",
          "action": "Create AmbientAgentOrchestratorService with onModuleInit(), onModuleDestroy(), startAgent(), stopAgent(), pauseAgent(), resumeAgent(), triggerPollNow() methods",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-3", "step-0-3"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/ambient-agent-orchestrator.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-1-6",
          "action": "Create pipeline node implementations: poll-data.node.ts, pre-filter.node.ts, triage.node.ts, specialists.node.ts, evaluators.node.ts, package-output.node.ts",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-3"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/nodes/poll-data.node.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/pre-filter.node.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/triage.node.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/specialists.node.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/evaluators.node.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/package-output.node.ts"
          ],
          "validation_checkpoint": "checkpoint-1",
          "human_checkpoint_id": null
        }
      ]
    },
    {
      "id": "phase-2",
      "label": "Stock Predictor Vertical Slice",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-2-1",
          "action": "Create predictions schema migration with datapoints, runs, triage_results, specialist_analyses, evaluator_challenges tables",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": [
            "apps/api/supabase/migrations/predictions/20260108000002_create_predictions_schema.sql",
            "apps/api/supabase/migrations/predictions/20260108000003_create_core_tables.sql"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-2",
          "action": "Create recommendations and outcomes tables migration",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-1"],
          "deliverables": [
            "apps/api/supabase/migrations/predictions/20260108000004_create_recommendation_tables.sql"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-3",
          "action": "Create PredictionTool interface and base-tool.ts with name, description, execute(instruments) contract",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-0-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/base-tool.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-4",
          "action": "Implement YahooFinanceTool with real Yahoo Finance API calls (free, no key required)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-3"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/yahoo-finance.tool.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-5",
          "action": "Implement AlphaVantageTool with API key support (optional, env ALPHA_VANTAGE_API_KEY)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-3"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/alpha-vantage.tool.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-6",
          "action": "Create StockPredictorRunnerService extending BasePredictionRunner with stock-specific preFilter, triageContexts, specialists, evaluatorContexts, riskProfiles",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-3", "step-2-4", "step-2-5"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/stock-predictor-runner.service.ts",
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/stock-predictor.module.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-7",
          "action": "Create stock tools barrel export (index.ts) and register in runner",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-4", "step-2-5", "step-2-6"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/index.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-2-8",
          "action": "Create seed data: one stock agent (us-tech-stocks-2025) with instruments [AAPL, MSFT, GOOGL, NVDA], runner: stock-predictor",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-6"],
          "deliverables": [
            "apps/api/supabase/seed/prediction-agents.sql"
          ],
          "validation_checkpoint": "checkpoint-2",
          "human_checkpoint_id": null
        }
      ]
    },
    {
      "id": "phase-3",
      "label": "Expand Stock Tools + Dashboard UI",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-3-1",
          "action": "Implement BloombergNewsTool parsing RSS feed for stock-related news claims",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-8"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/bloomberg-news.tool.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-2",
          "action": "Implement ReutersRssTool parsing Reuters RSS for news claims",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-8"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/reuters-rss.tool.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-3",
          "action": "Implement SecFilingsTool for SEC EDGAR filings (8-K, 10-K events)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-8"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/sec-filings.tool.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-4",
          "action": "Create PredictionAgentPane.vue main container orchestrating dashboard components",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-8"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/PredictionAgentPane.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-5",
          "action": "Create CurrentStateComponent.vue showing latest datapoint and active recommendations",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/CurrentStateComponent.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-6",
          "action": "Create InstrumentsComponent.vue for managing tracked instruments with add/remove",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/InstrumentsComponent.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-7",
          "action": "Create HistoryComponent.vue showing past predictions with outcomes, pagination, filtering",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/HistoryComponent.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-8",
          "action": "Create ToolsComponent.vue showing data source status and recent claims per tool",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/ToolsComponent.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-9",
          "action": "Create ConfigComponent.vue with risk profile, thresholds, and admin-only model config section",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/ConfigComponent.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-10",
          "action": "Create shared UI components: ClaimCard.vue, RecommendationRow.vue, OutcomeBadge.vue, ConfidenceBar.vue",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/shared/ClaimCard.vue",
            "apps/web/src/components/AgentPanes/Prediction/shared/RecommendationRow.vue",
            "apps/web/src/components/AgentPanes/Prediction/shared/OutcomeBadge.vue",
            "apps/web/src/components/AgentPanes/Prediction/shared/ConfidenceBar.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-11",
          "action": "Create API controller with endpoints: /predictions/current, /predictions/history, /instruments, /tools, /config, /status, /start, /stop, /pause, /resume, /poll-now",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-8"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/prediction.controller.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-3-12",
          "action": "Create prediction-agent.store.ts Pinia store for dashboard state management",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-4"],
          "deliverables": [
            "apps/web/src/stores/prediction-agent.store.ts"
          ],
          "validation_checkpoint": "checkpoint-3",
          "human_checkpoint_id": null
        }
      ]
    },
    {
      "id": "phase-4",
      "label": "Learning Loop + Outcomes",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-4-1",
          "action": "Create learning tables migration: postmortems, missed_opportunities, user_insights",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-12"],
          "deliverables": [
            "apps/api/supabase/migrations/predictions/20260108000005_create_learning_tables.sql"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-2",
          "action": "Create database functions: get_specialist_accuracy(p_agent_slug, p_instrument), get_postmortems_with_instrument(p_agent_slug, p_outcome)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-1"],
          "deliverables": [
            "apps/api/supabase/migrations/predictions/20260108000006_create_database_functions.sql"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-3",
          "action": "Implement OutcomeEvaluationService with evaluateOutcome(), calculateActualReturn() methods (domain-aware)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/outcome-evaluation.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-4",
          "action": "Implement PostmortemService with createPostmortem(), analyzeSpecialistAccuracy() methods",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-3"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/postmortem.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-5",
          "action": "Implement MissedOpportunityService with detectMissedOpportunity(), analyzeWhyMissed() methods",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/missed-opportunity.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-6",
          "action": "Implement LearningContextBuilderService with buildContext(), getPostmortems(), getMissedOpportunities(), getSpecialistStats(), getUserInsights() using SQL queries",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-2"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/learning-context.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-7",
          "action": "Implement LearningConversationService with processMessage(), applyContextUpdate(), buildLearningPrompt() methods",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-6"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/learning-conversation.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-8",
          "action": "Implement AgentContextUpdateService with appendToContext(), parseContextSections(), reconstructContext() methods (merges metadata)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-7"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/services/agent-context-update.service.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-9",
          "action": "Create LearningComponent.vue with stats display, learned patterns list, and chat interface",
          "agent": "web-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-7"],
          "deliverables": [
            "apps/web/src/components/AgentPanes/Prediction/LearningComponent.vue"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-4-10",
          "action": "Add learning API endpoints: /learning/chat, /learning/apply-update, /learning/stats, /learning/insights",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-7", "step-4-8"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/learning.controller.ts"
          ],
          "validation_checkpoint": "checkpoint-4",
          "human_checkpoint_id": null
        }
      ]
    },
    {
      "id": "phase-5",
      "label": "Additional Domains + Migration",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-5-1",
          "action": "Implement CryptoPredictorRunner with crypto-specific preFilter (5% threshold), onchain specialists team, degen/hodler risk profiles",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-10"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/crypto-predictor-runner.service.ts",
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/crypto-predictor.module.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-5-2",
          "action": "Implement crypto tools: BinanceTool, CoinGeckoTool, EtherscanTool, WhaleAlertsTool, DefiLlamaTool",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-1"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/tools/binance.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/tools/coingecko.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/tools/etherscan.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/tools/whale-alerts.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/tools/defillama.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/crypto-predictor/tools/index.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-5-3",
          "action": "Implement MarketPredictorRunner with polymarket-specific preFilter (5% odds shift), market/event/info specialist teams, speculator/researcher risk profiles",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-10"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/market-predictor/market-predictor-runner.service.ts",
            "apps/api/src/agent2agent/runners/prediction/market-predictor/market-predictor.module.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-5-4",
          "action": "Implement Polymarket tools: PolymarketOddsTool, PolymarketFinanceTool, GammaApiTool, ResolutionTrackerTool, NewsApiTool",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-3"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/market-predictor/tools/polymarket-odds.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/market-predictor/tools/polymarket-finance.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/market-predictor/tools/gamma-api.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/market-predictor/tools/resolution-tracker.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/market-predictor/tools/news-api.tool.ts",
            "apps/api/src/agent2agent/runners/prediction/market-predictor/tools/index.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-5-5",
          "action": "Create PredictionModule parent module importing StockPredictorModule, CryptoPredictorModule, MarketPredictorModule with RunnerFactoryService",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-2", "step-5-4"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/prediction.module.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-5-6",
          "action": "Create migration script to convert existing Finance Agent universes to prediction agents with runner: stock-predictor",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-5-5"],
          "deliverables": [
            "scripts/migrate-finance-to-predictions.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-5-7",
          "action": "Create indexes and RLS policies migration for predictions schema (service_role only)",
          "agent": "api-architecture-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-1"],
          "deliverables": [
            "apps/api/supabase/migrations/predictions/20260108000007_create_indexes_and_rls.sql"
          ],
          "validation_checkpoint": "checkpoint-5",
          "human_checkpoint_id": null
        }
      ]
    },
    {
      "id": "phase-6",
      "label": "Testing & Quality",
      "status": "pending",
      "progress": 0,
      "started_at": null,
      "completed_at": null,
      "steps": [
        {
          "id": "step-6-1",
          "action": "Create unit tests for base runner: base-prediction-runner.service.spec.ts, claim-processor.spec.ts, runner-factory.service.spec.ts",
          "agent": "testing-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/__tests__/base-prediction-runner.service.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/base/__tests__/claim-processor.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/__tests__/runner-factory.service.spec.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-6-2",
          "action": "Create unit tests for pipeline nodes: poll-data.node.spec.ts, pre-filter.node.spec.ts, triage.node.spec.ts, specialists.node.spec.ts, evaluators.node.spec.ts",
          "agent": "testing-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-1-6"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/base/nodes/__tests__/poll-data.node.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/__tests__/pre-filter.node.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/__tests__/triage.node.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/__tests__/specialists.node.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/base/nodes/__tests__/evaluators.node.spec.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-6-3",
          "action": "Create unit tests for stock tools: yahoo-finance.tool.spec.ts, alpha-vantage.tool.spec.ts",
          "agent": "testing-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-2-8"],
          "deliverables": [
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/__tests__/yahoo-finance.tool.spec.ts",
            "apps/api/src/agent2agent/runners/prediction/stock-predictor/tools/__tests__/alpha-vantage.tool.spec.ts"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-6-4",
          "action": "Create E2E curl test scripts: test-stock-predictor-curl.sh, test-prediction-lifecycle-curl.sh with real auth",
          "agent": "testing-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-11"],
          "deliverables": [
            "apps/api/testing/scripts/prediction-runner/test-stock-predictor-curl.sh",
            "apps/api/testing/scripts/prediction-runner/test-prediction-lifecycle-curl.sh",
            "apps/api/testing/scripts/prediction-runner/common/auth-helper.sh",
            "apps/api/testing/scripts/prediction-runner/common/assert-helper.sh"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-6-5",
          "action": "Create E2E curl test: test-learning-conversation-curl.sh for HITL session",
          "agent": "testing-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-4-10"],
          "deliverables": [
            "apps/api/testing/scripts/prediction-runner/test-learning-conversation-curl.sh"
          ],
          "validation_checkpoint": null,
          "human_checkpoint_id": null
        },
        {
          "id": "step-6-6",
          "action": "Create Cypress UI tests: dashboard.cy.ts, instruments.cy.ts, lifecycle-controls.cy.ts, learning-conversation.cy.ts",
          "agent": "testing-agent",
          "status": "pending",
          "progress": 0,
          "started_at": null,
          "completed_at": null,
          "depends_on": ["step-3-12", "step-4-9"],
          "deliverables": [
            "apps/web/tests/e2e/specs/prediction-agent/dashboard.cy.ts",
            "apps/web/tests/e2e/specs/prediction-agent/instruments.cy.ts",
            "apps/web/tests/e2e/specs/prediction-agent/lifecycle-controls.cy.ts",
            "apps/web/tests/e2e/specs/prediction-agent/learning-conversation.cy.ts"
          ],
          "validation_checkpoint": "checkpoint-6",
          "human_checkpoint_id": null
        }
      ]
    }
  ],
  "checkpoints": [
    {
      "id": "checkpoint-0",
      "label": "Gate A: Contracts Complete",
      "description": "All interfaces defined, can instantiate a no-op runner that loads agent config and returns empty result",
      "status": "pending",
      "triggered_after": ["step-0-4"]
    },
    {
      "id": "checkpoint-1",
      "label": "Gate B: Base Runner Functional",
      "description": "One agent can run one poll cycle and persist a datapoint with checkpointer state",
      "status": "pending",
      "triggered_after": ["step-1-6"]
    },
    {
      "id": "checkpoint-2",
      "label": "Gate C: Stock Vertical Slice",
      "description": "Stock predictor produces real recommendations stored in DB from Yahoo Finance data",
      "status": "pending",
      "triggered_after": ["step-2-8"]
    },
    {
      "id": "checkpoint-3",
      "label": "Gate D: Dashboard Complete",
      "description": "UI can display Current State, Instruments, History, Tools, Config from real stored data",
      "status": "pending",
      "triggered_after": ["step-3-12"]
    },
    {
      "id": "checkpoint-4",
      "label": "Gate E: Learning Loop Functional",
      "description": "Learning queries work with correct joins; at least one applied insight stored and affects context",
      "status": "pending",
      "triggered_after": ["step-4-10"]
    },
    {
      "id": "checkpoint-5",
      "label": "Gate F: Multi-Domain Ready",
      "description": "Stock, Crypto, and Polymarket runners all produce valid recommendations",
      "status": "pending",
      "triggered_after": ["step-5-7"]
    },
    {
      "id": "checkpoint-6",
      "label": "Gate G: Quality Complete",
      "description": "All unit tests pass (80%+ coverage), E2E curl scripts pass, Cypress UI tests pass",
      "status": "pending",
      "triggered_after": ["step-6-6"]
    }
  ],
  "dependencies": {
    "phase-1": ["phase-0"],
    "phase-2": ["phase-1"],
    "phase-3": ["phase-2"],
    "phase-4": ["phase-3"],
    "phase-5": ["phase-4"],
    "phase-6": ["phase-1", "phase-2", "phase-3", "phase-4"]
  },
  "execution_strategy": {
    "mode": "sequential",
    "parallel_phases": [],
    "notes": "Phases are sequential but testing (phase-6) steps can run in parallel with their dependent phases as they complete"
  }
}
