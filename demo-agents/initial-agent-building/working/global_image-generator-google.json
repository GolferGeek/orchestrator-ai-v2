{
  "id": "3c4a0de3-4519-48b6-a251-0dd662399d47",
  "organization_slug": "global",
  "slug": "image-generator-google",
  "display_name": "Google Imagen Generator",
  "description": "Generates images via Google Imagen 4 Fast API.",
  "agent_type": "function",
  "mode_profile": "function_full",
  "version": null,
  "status": "active",
  "yaml": "\n{\n    \"metadata\": {\n        \"name\": \"image-generator-google\",\n        \"displayName\": \"Google Imagen Generator\",\n        \"description\": \"Generates images via Google Imagen 4 Fast API.\",\n        \"version\": \"0.1.0\",\n        \"type\": \"function\",\n        \"tags\": [\n            \"image\",\n            \"google\",\n            \"imagen\"\n        ]\n    },\n    \"communication\": {\n        \"input_modes\": [\n            \"text/plain\",\n            \"application/json\"\n        ],\n        \"output_modes\": [\n            \"application/json\"\n        ]\n    },\n    \"configuration\": {\n        \"function\": {\n            \"language\": \"javascript\",\n            \"timeout_ms\": 20000,\n            \"code\": \"async function handler(input, ctx) {\\\\n  const axios = ctx.require(\\\\\"axios\\\\\");\\\\n  const crypto = ctx.require(\\\\\"crypto\\\\\");\\\\n\\\\n  // Parse input parameters\\\\n  const source = input || {};\\\\n  const basePrompt = typeof source.prompt === \\\\\"string\\\\\" ? source.prompt : \\\\\"\\\\\";\\\\n  const prompt =\\\\n    basePrompt.trim() ||\\\\n    (typeof source.userMessage === \\\\\"string\\\\\" ? source.userMessage.trim() : \\\\\"\\\");\\\\n  if (!prompt) {\\\\n    throw new Error(\\\\\"prompt is required\\\\\");\\\\n  }\\\\n\\\\n  // Parse count (1-4 images)\\\\n  const rawCount = Number(source.count ?? source.n ?? 1);\\\\n  const count = Math.max(\\\\n    1,\\\\n    Math.min(Number.isFinite(rawCount) ? rawCount : 1, 4)\\\\n  );\\\\n\\\\n  // Parse aspect ratio (supports 1:1, 3:4, 4:3, 9:16, 16:9)\\\\n  const validAspectRatios = [\\\\\"1:1\\\\\", \\\\\"3:4\\\\\", \\\\\"4:3\\\\\", \\\\\"9:16\\\\\", \\\\\"16:9\\\\\"];\\\\n  const aspectRatio =\\\\n    typeof source.aspectRatio === \\\\\"string\\\\\" &&\\\\n    validAspectRatios.includes(source.aspectRatio)\\\\n      ? source.aspectRatio\\\\n      : \\\\\"1:1\\\\\";\\\\n\\\\n  // Parse safety filter level\\\\n  const validSafetyLevels = [\\\\n    \\\\\"BLOCK_LOW_AND_ABOVE\\\\\",\\\\n    \\\\\"BLOCK_MEDIUM_AND_ABOVE\\\\\",\\\\n    \\\\\"BLOCK_ONLY_HIGH\\\\\",\\\\n    \\\\\"BLOCK_NONE\\\\\"\\\\n  ];\\\\n  const safetyFilterLevel =\\\\n    typeof source.safetyFilterLevel === \\\\\"string\\\\\" &&\\\\n    validSafetyLevels.includes(source.safetyFilterLevel)\\\\n      ? source.safetyFilterLevel\\\\n      : \\\\\"BLOCK_MEDIUM_AND_ABOVE\\\\\";\\\\n\\\\n  // Parse person generation setting\\\\n  const validPersonGeneration = [\\\\\"dont_allow\\\\\", \\\\\"allow_adult\\\\\", \\\\\"allow_all\\\\\"];\\\\n  const personGeneration =\\\\n    typeof source.personGeneration === \\\\\"string\\\\\" &&\\\\n    validPersonGeneration.includes(source.personGeneration)\\\\n      ? source.personGeneration\\\\n      : \\\\\"allow_adult\\\\\";\\\\n\\\\n  // Parse includeSafetyAttributes flag\\\\n  const includeSafetyAttributes = source.includeSafetyAttributes === true;\\\\n\\\\n  // Get environment variables\\\\n  const projectId = ctx.process.env.GOOGLE_PROJECT_ID;\\\\n  const accessToken = ctx.process.env.GOOGLE_ACCESS_TOKEN;\\\\n  const location =\\\\n    ctx.process.env.GOOGLE_REGION && ctx.process.env.GOOGLE_REGION.trim().length\\\\n      ? ctx.process.env.GOOGLE_REGION.trim()\\\\n      : \\\\\"us-central1\\\\\";\\\\n\\\\n  if (!projectId || !accessToken) {\\\\n    throw new Error(\\\\\"GOOGLE_PROJECT_ID and GOOGLE_ACCESS_TOKEN required\\\\\");\\\\n  }\\\\n\\\\n  // Build API endpoint for Imagen 4 Fast\\\\n  const endpoint = `https://aiplatform.googleapis.com/v1/projects/${projectId}/locations/${location}/publishers/google/models/imagen-4.0-fast-generate-001:predict`;\\\\n\\\\n  // Build request parameters\\\\n  const parameters = {\\\\n    sampleCount: count,\\\\n    aspectRatio: aspectRatio,\\\\n    safetyFilterLevel: safetyFilterLevel,\\\\n    personGeneration: personGeneration,\\\\n  };\\\\n\\\\n  if (includeSafetyAttributes) {\\\\n    parameters.includeSafetyAttributes = true;\\\\n  }\\\\n\\\\n  // Make API request\\\\n  const response = await axios.post(\\\\n    endpoint,\\\\n    {\\\\n      instances: [{ prompt }],\\\\n      parameters: parameters,\\\\n    },\\\\n    {\\\\n      headers: {\\\\n        Authorization: `Bearer ${accessToken}`,\\\\n        \\\\\"Content-Type\\\\\": \\\\\"application/json\\\\\",\\\\n      },\\\\n      timeout: 120000,\\\\n    }\\\\n  );\\\\n\\\\n  // Process predictions\\\\n  const predictions = Array.isArray(response.data?.predictions)\\\\n    ? response.data.predictions\\\\n    : [];\\\\n\\\\n  if (!predictions.length) {\\\\n    throw new Error(\\\\\"Google Imagen returned no predictions\\\\\");\\\\n  }\\\\n\\\\n  // Process each generated image\\\\n  const attachments = [];\\\\n  for (let index = 0; index < predictions.length; index++) {\\\\n    const prediction = predictions[index] || {};\\\\n    const base64 =\\\\n      prediction.bytesBase64Encoded ||\\\\n      prediction.imageBytes ||\\\\n      prediction.data;\\\\n    if (!base64 || typeof base64 !== \\\\\"string\\\\\") {\\\\n      continue;\\\\n    }\\\\n\\\\n    const buffer = Buffer.from(base64, \\\\\"base64\\\\\");\\\\n    if (!buffer.length) {\\\\n      continue;\\\\n    }\\\\n\\\\n    const mime =\\\\n      typeof prediction.mimeType === \\\\\"string\\\\\" && prediction.mimeType.length\\\\n        ? prediction.mimeType\\\\n        : \\\\\"image/png\\\\\";\\\\n    const extension = mime.split(\\\\\"/\\\\\")[1] || \\\\\"png\\\\\";\\\\n    const hash = crypto.createHash(\\\\\"sha256\\\\\").update(buffer).digest(\\\\\"hex\\\\\");\\\\n\\\\n    // Save image asset\\\\n    const asset = await ctx.assets.saveBuffer({\\\\n      buffer,\\\\n      mime,\\\\n      filename: `google-imagen4-${Date.now()}-${index}.${extension}`,\\\\n      subpath: \\\\\"generated\\\\\",\\\\n    });\\\\n\\\\n    // Build attachment metadata\\\\n    const attachment = {\\\\n      assetId: asset.id,\\\\n      url: `/assets/${asset.id}`,\\\\n      mime,\\\\n      size: buffer.length,\\\\n      hash,\\\\n      altText: prompt,\\\\n      provider: \\\\\"google\\\\\",\\\\n      model: \\\\\"imagen-4.0-fast\\\\\",\\\\n      index,\\\\n      aspectRatio,\\\\n    };\\\\n\\\\n    // Include safety attributes if requested\\\\n    if (includeSafetyAttributes && prediction.safetyAttributes) {\\\\n      attachment.safetyAttributes = prediction.safetyAttributes;\\\\n    }\\\\n\\\\n    attachments.push(attachment);\\\\n  }\\\\n\\\\n  if (!attachments.length) {\\\\n    throw new Error(\\\\\"Failed to generate image attachments\\\\\");\\\\n  }\\\\n\\\\n  // Get deliverable title\\\\n  const title =\\\\n    typeof source.title === \\\\\"string\\\\\" && source.title.trim().length\\\\n      ? source.title.trim()\\\\n      : \\\\\"Google Imagen Set\\\\\";\\\\n\\\\n  // Create deliverable\\\\n  const deliverable = await ctx.deliverables.create({\\\\n    title,\\\\n    content: `Generated ${attachments.length} image(s) via Google Imagen 4 Fast (${aspectRatio} aspect ratio)`,\\\\n    format: attachments[0]?.mime || \\\\\"image/png\\\\\",\\\\n    type: \\\\\"image\\\\\",\\\\n    attachments: { images: attachments },\\\\n    metadata: {\\\\n      provider: \\\\\"google\\\\\",\\\\n      model: \\\\\"imagen-4.0-fast-generate-001\\\\\",\\\\n      sdk: \\\\\"@google/genai\\\\\",\\\\n      prompt,\\\\n      count: attachments.length,\\\\n      location,\\\\n      aspectRatio,\\\\n      safetyFilterLevel,\\\\n      personGeneration,\\\\n      includeSafetyAttributes,\\\\n      synthid_watermarked: true,\\\\n    },\\\\n  });\\\\n\\\\n  // Return structured response\\\\n  return {\\\\n    success: true,\\\\n    provider: \\\\\"google\\\\\",\\\\n    model: \\\\\"imagen-4.0-fast-generate-001\\\\\",\\\\n    deliverable,\\\\n    images: attachments,\\\\n    metadata: {\\\\n      prompt,\\\\n      count: attachments.length,\\\\n      location,\\\\n      aspectRatio,\\\\n      safetyFilterLevel,\\\\n      personGeneration,\\\\n      synthid_watermarked: true,\\\\n    },\\\\n  };\\\\n}\\\\n\\\\nmodule.exports = handler;\"\n        },\n        \"execution_capabilities\": {\n            \"supports_converse\": false,\n            \"supports_plan\": false,\n            \"supports_build\": true\n        }\n    },\n    \"prompts\": {\n        \"system\": \"Generate images via Google Imagen 4 Fast. Optimise prompts for business storytelling and keep metadata concise.\"\n    }\n}\n",
  "context": {
    "agent_type": "function",
    "mode_profile": "function_full",
    "execution_capabilities": {
      "supports_converse": false,
      "supports_plan": false,
      "supports_build": true
    },
    "technical_requirements": {
      "environment_variables": {
        "GOOGLE_PROJECT_ID": "Google Cloud project identifier",
        "GOOGLE_ACCESS_TOKEN": "OAuth 2.0 access token for authentication",
        "GOOGLE_REGION": "Regional endpoint (default: us-central1)"
      },
      "dependencies": ["axios", "crypto"],
      "sdk": "@google/genai",
      "api_endpoint": "https://aiplatform.googleapis.com/v1/projects/{projectId}/locations/{location}/publishers/google/models/imagen-4.0-fast-generate-001:predict",
      "timeout_ms": 120000
    },
    "models": {
      "primary": {
        "name": "imagen-4.0-fast-generate-001",
        "provider": "google",
        "type": "image-generation",
        "description": "Google Imagen 4 Fast - optimized for rapid, high-quality image generation",
        "max_images_per_request": 4,
        "default_resolution": "1024x1024",
        "max_resolution": "2048x2048"
      },
      "alternative": {
        "name": "gemini-2.5-flash-image",
        "provider": "google",
        "type": "conversational-image-generation",
        "description": "Gemini 2.5 Flash Image - lightweight, conversational image generation"
      },
      "deprecated": ["imagen-1", "imagen-2"]
    },
    "input_parameters": {
      "required": {
        "prompt": {
          "type": "string",
          "description": "Text description of the image to generate",
          "alternative_fields": ["userMessage"],
          "validation": "non-empty string after trimming"
        }
      },
      "optional": {
        "count": {
          "type": "number",
          "description": "Number of images to generate",
          "range": [1, 4],
          "default": 1,
          "alternative_fields": ["n"]
        },
        "aspectRatio": {
          "type": "string",
          "description": "Image aspect ratio",
          "options": ["1:1", "3:4", "4:3", "9:16", "16:9"],
          "default": "1:1",
          "resolutions": {
            "1:1": "1024x1024"
          }
        },
        "safetyFilterLevel": {
          "type": "string",
          "description": "Content filtering strictness",
          "options": ["BLOCK_LOW_AND_ABOVE", "BLOCK_MEDIUM_AND_ABOVE", "BLOCK_ONLY_HIGH", "BLOCK_NONE"],
          "default": "BLOCK_MEDIUM_AND_ABOVE"
        },
        "personGeneration": {
          "type": "string",
          "description": "Control person image generation",
          "options": ["dont_allow", "allow_adult", "allow_all"],
          "default": "allow_adult",
          "restrictions": {
            "allow_all": "Prohibited in EU, UK, CH, MENA regions"
          }
        },
        "title": {
          "type": "string",
          "description": "Display title for the deliverable set",
          "default": "Google Imagen Set"
        },
        "includeSafetyAttributes": {
          "type": "boolean",
          "description": "Include detailed safety scores for 12 categories",
          "default": false
        }
      }
    },
    "output_format": {
      "deliverable_structure": {
        "success": "boolean",
        "provider": "google",
        "deliverable": {
          "title": "string",
          "content": "string",
          "format": "image/png",
          "type": "image",
          "attachments": {
            "images": "Array<ImageAttachment>"
          },
          "metadata": {
            "provider": "google",
            "model": "imagen-4.0-fast",
            "prompt": "string",
            "count": "number",
            "location": "string"
          }
        },
        "images": "Array<ImageAttachment>",
        "metadata": "object"
      },
      "image_attachment_structure": {
        "assetId": "Unique asset identifier",
        "url": "Asset access URL path",
        "mime": "MIME type (typically image/png)",
        "size": "File size in bytes",
        "hash": "SHA-256 hash for verification",
        "altText": "Original prompt for accessibility",
        "provider": "google",
        "index": "Position in generation batch"
      }
    },
    "safety_compliance": {
      "synthid_watermarking": {
        "enabled": true,
        "description": "Invisible AI-detectable watermarks on all generated images",
        "removable": false
      },
      "safety_categories": [
        "Death, Harm & Tragedy",
        "Firearms & Weapons",
        "Hate & Discrimination",
        "Health Misinformation",
        "Illicit Drugs",
        "Politics & Political Figures",
        "Pornography & Sexual Content",
        "Religion & Belief Systems",
        "Toxic Language",
        "Violence & Gore",
        "Vulgarity & Profanity",
        "War & Conflict"
      ],
      "regional_restrictions": {
        "EU": "person_generation=allow_all prohibited",
        "UK": "person_generation=allow_all prohibited",
        "CH": "person_generation=allow_all prohibited",
        "MENA": "person_generation=allow_all prohibited"
      }
    },
    "best_practices": {
      "prompt_optimization": {
        "be_specific": "Include details about style, composition, lighting, mood",
        "business_focus": "Optimize for business storytelling and professional imagery",
        "avoid_ambiguity": "Clear descriptions produce better results",
        "optimal_length": "10-50 words typically optimal"
      },
      "example_prompts": {
        "good": "Modern office workspace with natural lighting, minimalist design, laptop on desk, plants, warm tones",
        "poor": "office"
      }
    },
    "performance": {
      "typical_generation_time": "10-20 seconds",
      "quality": "High-quality, photorealistic results",
      "max_resolution": "1024x1024 (fast), 2048x2048 (standard)",
      "use_case": "Production workflows requiring speed and quality balance"
    },
    "asset_management": {
      "storage_method": "ctx.assets.saveBuffer()",
      "subpath": "generated",
      "filename_pattern": "google-{timestamp}-{index}.{extension}",
      "mime_type_detection": "automatic from API response"
    },
    "defaults": {
      "size": "1024x1024",
      "aspect_ratio": "1:1",
      "count": 1,
      "safety_filter": "BLOCK_MEDIUM_AND_ABOVE",
      "person_generation": "allow_adult"
    },
    "input_modes": [
      "text/plain",
      "application/json"
    ],
    "output_modes": [
      "application/json"
    ],
    "supported_modes": [
      "build"
    ]
  },
  "created_at": "2025-10-12T18:39:12.663667+00:00",
  "updated_at": "2025-10-13T18:27:20.632573+00:00",
  "function_code": null,
  "plan_structure": null,
  "deliverable_structure": {
    "type": "image",
    "format": "image/png",
    "multiple": true,
    "max_count": 4,
    "includes_metadata": true,
    "watermarked": true,
    "provider": "google",
    "model": "imagen-4.0-fast-generate-001"
  },
  "io_schema": {
    "input": {
      "type": "object",
      "required": ["prompt"],
      "properties": {
        "prompt": {
          "type": "string",
          "description": "Text description of the image to generate",
          "example": "Modern office workspace with natural lighting, minimalist design"
        },
        "count": {
          "type": "number",
          "description": "Number of images to generate (1-4)",
          "default": 1,
          "minimum": 1,
          "maximum": 4
        },
        "aspectRatio": {
          "type": "string",
          "description": "Image aspect ratio",
          "enum": ["1:1", "3:4", "4:3", "9:16", "16:9"],
          "default": "1:1"
        },
        "safetyFilterLevel": {
          "type": "string",
          "description": "Content filtering strictness",
          "enum": ["BLOCK_LOW_AND_ABOVE", "BLOCK_MEDIUM_AND_ABOVE", "BLOCK_ONLY_HIGH", "BLOCK_NONE"],
          "default": "BLOCK_MEDIUM_AND_ABOVE"
        },
        "personGeneration": {
          "type": "string",
          "description": "Control person image generation",
          "enum": ["dont_allow", "allow_adult", "allow_all"],
          "default": "allow_adult"
        },
        "title": {
          "type": "string",
          "description": "Display title for the deliverable set",
          "default": "Google Imagen Set"
        },
        "includeSafetyAttributes": {
          "type": "boolean",
          "description": "Include detailed safety scores",
          "default": false
        }
      }
    },
    "output": {
      "type": "object",
      "properties": {
        "success": {
          "type": "boolean",
          "description": "Whether image generation succeeded"
        },
        "provider": {
          "type": "string",
          "const": "google"
        },
        "model": {
          "type": "string",
          "const": "imagen-4.0-fast-generate-001"
        },
        "deliverable": {
          "type": "object",
          "description": "Deliverable containing generated images",
          "properties": {
            "title": {
              "type": "string"
            },
            "content": {
              "type": "string"
            },
            "format": {
              "type": "string",
              "const": "image/png"
            },
            "type": {
              "type": "string",
              "const": "image"
            },
            "attachments": {
              "type": "object",
              "properties": {
                "images": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "assetId": {
                        "type": "string",
                        "description": "Unique asset identifier"
                      },
                      "url": {
                        "type": "string",
                        "description": "Asset access URL path"
                      },
                      "mime": {
                        "type": "string",
                        "description": "MIME type (image/png)"
                      },
                      "size": {
                        "type": "number",
                        "description": "File size in bytes"
                      },
                      "hash": {
                        "type": "string",
                        "description": "SHA-256 hash for verification"
                      },
                      "altText": {
                        "type": "string",
                        "description": "Original prompt for accessibility"
                      },
                      "provider": {
                        "type": "string",
                        "const": "google"
                      },
                      "model": {
                        "type": "string",
                        "const": "imagen-4.0-fast"
                      },
                      "index": {
                        "type": "number",
                        "description": "Position in generation batch"
                      },
                      "aspectRatio": {
                        "type": "string",
                        "description": "Aspect ratio used"
                      }
                    }
                  }
                }
              }
            },
            "metadata": {
              "type": "object",
              "properties": {
                "provider": {
                  "type": "string",
                  "const": "google"
                },
                "model": {
                  "type": "string"
                },
                "sdk": {
                  "type": "string",
                  "const": "@google/genai"
                },
                "prompt": {
                  "type": "string"
                },
                "count": {
                  "type": "number"
                },
                "location": {
                  "type": "string"
                },
                "aspectRatio": {
                  "type": "string"
                },
                "safetyFilterLevel": {
                  "type": "string"
                },
                "personGeneration": {
                  "type": "string"
                },
                "synthid_watermarked": {
                  "type": "boolean",
                  "const": true
                }
              }
            }
          }
        },
        "images": {
          "type": "array",
          "description": "Array of generated image attachments",
          "items": {
            "type": "object"
          }
        },
        "metadata": {
          "type": "object",
          "description": "Summary metadata about generation"
        }
      }
    }
  }
}